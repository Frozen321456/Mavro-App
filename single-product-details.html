<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Product Details | Espera Mavro</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        :root { 
            --primary: #000000; 
            --accent: #ff385c; 
            --bg: #ffffff; 
            --secondary-bg: #f8f8f8; 
            --text-muted: #666; 
            --border: #e2e2e2; 
            --gold: #c5a059;
            --soft-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        body { 
            background-color: var(--bg); 
            color: var(--primary); 
            line-height: 1.5; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
        }
        
        /* Header */
        .header { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 70px; 
            background: rgba(255, 255, 255, 0.98); 
            backdrop-filter: blur(10px); 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 0 5%; 
            z-index: 1000; 
            border-bottom: 1px solid var(--border); 
        }
        
        .nav-icon { 
            font-size: 20px; 
            color: var(--primary); 
            cursor: pointer;
            text-decoration: none; 
            width: 40px; 
            height: 40px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            border-radius: 50%; 
        }
        
        .logo { 
            font-weight: 800; 
            font-size: 20px; 
            text-decoration: none; 
            color: var(--primary); 
            letter-spacing: 1.5px; 
        }
        
        .logo span { color: var(--accent); }
        
        .nav-actions { display: flex; align-items: center; gap: 15px; }
        
        .cart-count { 
            position: absolute; 
            top: 15px; 
            right: calc(5% + 5px); 
            background: var(--accent); 
            color: #fff; 
            font-size: 11px; 
            font-weight: 700; 
            min-width: 18px; 
            height: 18px; 
            border-radius: 18px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }

        /* Sidebar */
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); opacity: 0; pointer-events: none; transition: 0.3s; z-index: 1999; }
        .sidebar-overlay.active { opacity: 1; pointer-events: all; }
        .sidebar { position: fixed; top: 0; left: -100%; width: 260px; height: 100%; background: #fff; z-index: 2000; transition: 0.3s; padding: 35px 20px; overflow-y: auto; }
        .sidebar.active { left: 0; }
        .sidebar-close { position: absolute; right: 12px; top: 12px; font-size: 18px; cursor: pointer; }
        .side-links { margin-top: 35px; }
        .side-links a { display: block; font-size: 16px; font-weight: 700; color: #000; text-decoration: none; margin-bottom: 15px; }
        .side-cats-title { margin-top: 25px; font-size: 10px; font-weight: 700; color: #888; letter-spacing: 1px; margin-bottom: 12px; }
        .side-cat-list a { display: block; font-size: 13px; font-weight: 500; margin-bottom: 10px; color: #444; text-decoration: none; }
        .side-cat-list a i { width: 18px; margin-right: 6px; color: var(--accent); font-size: 12px; }
        
        .main-container { 
            max-width: 1400px; 
            margin: 70px auto 0; 
            width: 100%; 
            flex: 1;
        }
        
        .product-layout { 
            display: flex; 
            flex-direction: column; 
        }
        
        .gallery-section { 
            width: 100%; 
            background: var(--secondary-bg); 
            position: relative; 
            overflow: hidden; 
        }
        
        .slider-container { 
            width: 100%; 
            height: 400px; 
            overflow: hidden; 
            position: relative; 
            touch-action: pan-y; 
        }
        
        .slider-wrapper { 
            display: flex; 
            height: 100%; 
            transition: transform 0.3s ease-out; 
        }
        
        .slider-wrapper img { 
            min-width: 100%; 
            width: 100%; 
            height: 100%; 
            object-fit: contain; 
            background: var(--secondary-bg); 
        }
        
        .info-section { 
            padding: 24px 5%; 
            background: #fff; 
        }
        
        .product-title { 
            font-size: 24px; 
            font-weight: 700; 
            margin-bottom: 16px; 
        }
        
        .price-box { 
            display: flex; 
            align-items: baseline; 
            gap: 12px; 
            margin-bottom: 24px; 
            padding-bottom: 24px; 
            border-bottom: 1px solid var(--border); 
        }
        
        .sale-price { 
            font-size: 32px; 
            font-weight: 800; 
            color: var(--accent); 
        }
        
        .regular-price-old { 
            font-size: 20px; 
            color: #999; 
            text-decoration: line-through; 
        }
        
        .variation-section { 
            margin-bottom: 24px; 
        }
        
        .variation-label { 
            font-size: 14px; 
            font-weight: 600; 
            color: var(--text-muted); 
            margin-bottom: 12px; 
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .variation-count {
            background: var(--secondary-bg);
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
        }
        
        .variation-options-container {
            max-height: 320px;
            overflow-y: auto;
            padding-right: 5px;
            margin-bottom: 10px;
            border-radius: 12px;
            scrollbar-width: thin;
            scrollbar-color: var(--border) var(--secondary-bg);
        }
        
        .variation-options-container::-webkit-scrollbar {
            width: 4px;
        }
        
        .variation-options-container::-webkit-scrollbar-track {
            background: var(--secondary-bg);
            border-radius: 10px;
        }
        
        .variation-options-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 10px;
        }
        
        .variation-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }
        
        .variation-option { 
            border: 2px solid var(--border); 
            padding: 14px 16px; 
            border-radius: 12px; 
            cursor: pointer; 
            transition: all 0.2s; 
            font-weight: 500;
            font-size: 14px;
            line-height: 1.4;
            word-break: break-word;
            background: white;
            box-shadow: var(--soft-shadow);
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .variation-option:hover {
            border-color: var(--primary);
            background: var(--secondary-bg);
        }
        
        .variation-option.active { 
            background: var(--primary); 
            color: #fff; 
            border-color: var(--primary); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .variation-name {
            font-weight: 600;
            font-size: 13px;
            color: var(--primary);
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .variation-option.active .variation-name {
            color: #fff;
            opacity: 0.9;
        }
        
        .variation-value {
            font-size: 14px;
            font-weight: 500;
        }
        
        .variation-price-badge {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            margin-top: 4px;
            align-self: flex-start;
        }
        
        .variation-option.active .variation-price-badge {
            background: white;
            color: var(--primary);
        }
        
        .add-to-cart-btn { 
            background: var(--primary); 
            color: #fff; 
            border: none; 
            padding: 18px; 
            border-radius: 50px; 
            font-weight: 700; 
            width: 100%; 
            cursor: pointer; 
            margin-bottom: 30px; 
            font-size: 16px; 
            transition: all 0.3s; 
        }
        
        .add-to-cart-btn:hover { 
            background: #333; 
        }
        
        .description-content { 
            font-size: 15px; 
            color: #444; 
            line-height: 1.7; 
        }

        /* Recommended Products Section */
        .recommended-section {
            padding: 40px 5%;
            background: var(--secondary-bg);
            border-top: 1px solid var(--border);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            font-size: 18px;
            font-weight: 800;
        }

        .section-header a {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-decoration: none;
        }

        .recommended-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .rec-card {
            background: #fff;
            border-radius: 16px;
            overflow: hidden;
            text-decoration: none;
            color: inherit;
            transition: all 0.3s;
            border: 1px solid var(--border);
            box-shadow: var(--soft-shadow);
        }

        .rec-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.08);
        }

        .rec-img {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: cover;
            background: var(--secondary-bg);
        }

        .rec-info {
            padding: 12px;
        }

        .rec-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .rec-price {
            font-size: 14px;
            font-weight: 700;
            color: var(--accent);
        }

        @media (max-width: 768px) {
            .recommended-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }

        /* ========== PROFESSIONAL FOOTER STYLES ========== */
        .footer {
            background: #0a0a0a;
            color: #fff;
            margin-top: 0;
            position: relative;
            border-top: 1px solid #222;
        }

        .footer-main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 50px 5% 30px;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 992px) {
            .footer-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .footer-grid {
                grid-template-columns: 1fr;
            }
        }

        .footer-col h4 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-col h4::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 2px;
            background: #ff385c;
        }

        .footer-logo {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 15px;
            color: #fff;
        }

        .footer-logo span {
            color: #ff385c;
        }

        .footer-about {
            font-size: 13px;
            line-height: 1.6;
            color: #aaa;
            margin-bottom: 20px;
        }

        .footer-social {
            display: flex;
            gap: 12px;
        }

        .footer-social a {
            width: 36px;
            height: 36px;
            background: #1a1a1a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            text-decoration: none;
            transition: all 0.3s;
        }

        .footer-social a:hover {
            background: #ff385c;
            transform: translateY(-3px);
        }

        .footer-links {
            list-style: none;
            padding: 0;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: #aaa;
            text-decoration: none;
            font-size: 13px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-links a i {
            font-size: 10px;
            color: #ff385c;
        }

        .footer-links a:hover {
            color: #ff385c;
            transform: translateX(5px);
        }

        .footer-contact {
            list-style: none;
            padding: 0;
        }

        .footer-contact li {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 15px;
            color: #aaa;
            font-size: 13px;
            line-height: 1.5;
        }

        .footer-contact li i {
            color: #ff385c;
            font-size: 14px;
            margin-top: 3px;
        }

        .footer-contact a {
            color: #aaa;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-contact a:hover {
            color: #ff385c;
        }

        .footer-payment {
            margin-top: 20px;
        }

        .footer-payment h5 {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .payment-icons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .payment-icons i {
            font-size: 28px;
            color: #666;
            transition: color 0.3s;
        }

        .payment-icons i:hover {
            color: #ff385c;
        }

        /* Newsletter Section */
        .footer-newsletter {
            background: #111;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .newsletter-content h4 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .newsletter-content p {
            color: #aaa;
            font-size: 13px;
        }

        .newsletter-form {
            display: flex;
            gap: 10px;
            flex: 1;
            max-width: 400px;
        }

        .newsletter-form input {
            flex: 1;
            padding: 12px 16px;
            border-radius: 30px;
            border: 1px solid #333;
            background: #1a1a1a;
            color: #fff;
            font-size: 13px;
        }

        .newsletter-form input:focus {
            outline: none;
            border-color: #ff385c;
        }

        .newsletter-form button {
            padding: 12px 24px;
            border-radius: 30px;
            border: none;
            background: #ff385c;
            color: #fff;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .newsletter-form button:hover {
            background: #e62e4e;
            transform: translateY(-2px);
        }

        /* Bottom Footer */
        .footer-bottom {
            border-top: 1px solid #222;
            padding: 20px 5%;
            background: #050505;
        }

        .footer-bottom-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .footer-copyright {
            color: #666;
            font-size: 12px;
        }

        .footer-legal {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .footer-legal a {
            color: #888;
            text-decoration: none;
            font-size: 12px;
            transition: color 0.3s;
        }

        .footer-legal a:hover {
            color: #ff385c;
        }

        /* Scroll to Top Button */
        .scroll-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 45px;
            height: 45px;
            background: #ff385c;
            color: #fff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(255, 56, 92, 0.3);
            transition: all 0.3s;
            z-index: 99;
        }

        .scroll-top:hover {
            background: #e62e4e;
            transform: translateY(-3px);
        }

        .scroll-top.show {
            display: flex;
        }

        /* Loading State */
        .loading { 
            text-align: center; 
            padding: 60px; 
            color: #888; 
        }

        .loading i { 
            font-size: 30px; 
            margin-bottom: 10px; 
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .variation-options {
                grid-template-columns: 1fr;
            }
            .variation-option {
                padding: 16px;
            }
            
            .footer-newsletter {
                flex-direction: column;
                text-align: center;
            }
            
            .newsletter-form {
                max-width: 100%;
            }
            
            .footer-bottom-content {
                flex-direction: column;
                text-align: center;
            }
            
            .footer-legal {
                justify-content: center;
            }
            
            .scroll-top {
                bottom: 20px;
                right: 20px;
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
        }
        
        @media (min-width: 1024px) { 
            .product-layout { flex-direction: row; } 
            .gallery-section { width: 55%; position: sticky; top: 70px; height: calc(100vh - 70px); } 
            .info-section { width: 45%; } 
            .slider-container { height: 100%; } 
            .variation-options-container {
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <!-- Header with Hamburger -->
    <header class="header">
        <div class="nav-icon" onclick="toggleMenu()"><i class="fa-solid fa-bars-staggered"></i></div>
        <a href="index.html" class="logo">ESPERA <span>MAVRO.</span></a>
        <div class="nav-actions">
            <a href="cart.html" class="nav-icon" style="position: relative;">
                <i class="fa-solid fa-bag-shopping"></i>
                <span class="cart-count" id="cartCount">0</span>
            </a>
        </div>
    </header>

    <!-- Sidebar -->
    <div class="sidebar-overlay" id="overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-close" onclick="toggleMenu()"><i class="fa-solid fa-xmark"></i></div>
        <div class="side-links">
            <a href="index.html">Home</a>
            <a href="shop.html">Shop</a>
            <a href="track-order.html">Track Order</a>
            <a href="cart.html">Cart</a>
        </div>
        <div class="side-cats-title">CATEGORIES</div>
        <div class="side-cat-list" id="sideCats"></div>
    </div>

    <div class="main-container">
        <div id="loadingState" style="text-align:center; padding: 100px;">
            <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--accent);"></i>
            <p style="margin-top: 15px;">Loading Product...</p>
        </div>
        
        <div class="product-layout" id="productLayout" style="display: none;">
            <div class="gallery-section">
                <div class="slider-container" id="sliderContainer">
                    <div class="slider-wrapper" id="sliderWrapper"></div>
                </div>
            </div>
            <div class="info-section">
                <h1 class="product-title" id="productName"></h1>
                <div class="price-box" id="priceBox"></div>
                <div id="variationsContainer"></div>
                <button class="add-to-cart-btn" id="addToCartBtn">ADD TO CART</button>
                <div class="description-section">
                    <h3 style="margin-bottom:10px; font-size:14px; color:var(--text-muted);">PRODUCT DETAILS</h3>
                    <div class="description-content" id="productDescription"></div>
                </div>
            </div>
        </div>

        <!-- Recommended Products Section -->
        <div class="recommended-section" id="recommendedSection" style="display: none;">
            <div class="section-header">
                <h2>You may also like</h2>
                <a href="shop.html">View all</a>
            </div>
            <div class="recommended-grid" id="recommendedGrid"></div>
        </div>
    </div>

    <!-- ========== PROFESSIONAL FOOTER ========== -->
    <footer class="footer">
        <!-- Main Footer -->
        <div class="footer-main">
            <div class="footer-grid">
                <!-- Column 1: Brand & About -->
                <div class="footer-col">
                    <div class="footer-logo">ESPERA <span>MAVRO.</span></div>
                    <p class="footer-about">Premium global sourcing platform connecting Bangladesh businesses with international suppliers. Door-to-door delivery, wholesale pricing, and reliable fulfillment.</p>
                    <div class="footer-social">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>

                <!-- Column 2: Quick Links -->
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="index.html"><i class="fas fa-chevron-right"></i> Home</a></li>
                        <li><a href="shop.html"><i class="fas fa-chevron-right"></i> Shop</a></li>
                        <li><a href="track-order.html"><i class="fas fa-chevron-right"></i> Track Order</a></li>
                        <li><a href="cart.html"><i class="fas fa-chevron-right"></i> Cart</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Wholesale</a></li>
                    </ul>
                </div>

                <!-- Column 3: Categories -->
                <div class="footer-col">
                    <h4>Categories</h4>
                    <ul class="footer-links" id="footerCategories">
                        <!-- Categories will be loaded dynamically -->
                        <li><i class="fas fa-spinner fa-spin"></i> Loading...</li>
                    </ul>
                </div>

                <!-- Column 4: Contact Info -->
                <div class="footer-col">
                    <h4>Contact Us</h4>
                    <ul class="footer-contact">
                        <li><i class="fas fa-map-marker-alt"></i> Dhaka, Bangladesh</li>
                        <li><i class="fas fa-phone-alt"></i> <a href="tel:+8801721383418">+880 1721-383418</a></li>
                        <li><i class="fas fa-envelope"></i> <a href="mailto:esperamavro@gmail.com">esperamavro@gmail.com</a></li>
                        <li><i class="fas fa-clock"></i> Support: 24/7</li>
                    </ul>
                    
                    <!-- Payment Methods -->
                    <div class="footer-payment">
                        <h5>We Accept</h5>
                        <div class="payment-icons">
                            <i class="fab fa-cc-visa" title="Visa"></i>
                            <i class="fab fa-cc-mastercard" title="Mastercard"></i>
                            <i class="fab fa-cc-amex" title="American Express"></i>
                            <i class="fab fa-cc-paypal" title="PayPal"></i>
                            <i class="fab fa-bkash" title="bKash"></i>
                            <i class="fas fa-credit-card" title="Nagad"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Newsletter Section -->
            <div class="footer-newsletter">
                <div class="newsletter-content">
                    <h4>Subscribe to Our Newsletter</h4>
                    <p>Get updates on new collections, exclusive deals, and wholesale offers</p>
                </div>
                <form class="newsletter-form" onsubmit="event.preventDefault(); subscribeNewsletter()">
                    <input type="email" id="newsletterEmail" placeholder="Your email address" required>
                    <button type="submit">Subscribe</button>
                </form>
            </div>
        </div>

        <!-- Bottom Footer -->
        <div class="footer-bottom">
            <div class="footer-bottom-content">
                <div class="footer-copyright">
                    © 2026 <strong>Espera Mavro</strong>. All rights reserved. Global Sourcing Platform
                </div>
                <div class="footer-legal">
                    <a href="privacy.html">Privacy Policy</a>
                    <a href="terms.html">Terms of Service</a>
                    <a href="refund.html">Refund Policy</a>
                    <a href="#">Shipping Info</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll to Top Button -->
    <button class="scroll-top" onclick="scrollToTop()" id="scrollTopBtn" aria-label="Scroll to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAB7dyaJwkadV7asGOhj6TCN5it5pCWg10",
            authDomain: "espera-mavro-6ddc5.firebaseapp.com",
            databaseURL: "https://espera-mavro-6ddc5-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "espera-mavro-6ddc5",
            storageBucket: "espera-mavro-6ddc5.appspot.com",
            appId: "1:137893255543:web:a660bd412eb26ee322a972"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // icons helper for sidebar
        const categoryIcons = {
            'fashion': 'fa-solid fa-shirt',
            'womens fashion': 'fa-solid fa-person-dress',
            'bag': 'fa-solid fa-bag-shopping',
            'household': 'fa-solid fa-couch',
            'cosmetics': 'fa-solid fa-spray-can-sparkles',
            'beauty': 'fa-solid fa-star',
            'default': 'fa-solid fa-cube'
        };
        
        function getCategoryIcon(catName) {
            if (!catName) return categoryIcons.default;
            const key = catName.toLowerCase();
            if (key.includes('fashion')) return 'fa-solid fa-shirt';
            if (key.includes('womens')) return 'fa-solid fa-person-dress';
            if (key.includes('bag')) return 'fa-solid fa-bag-shopping';
            if (key.includes('house')) return 'fa-solid fa-couch';
            if (key.includes('cosmetic')) return 'fa-solid fa-spray-can-sparkles';
            return categoryIcons.default;
        }

        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        // LOAD CATEGORIES FOR SIDEBAR
        function loadSideCategories() {
            database.ref('categories').once('value', (snapshot) => {
                const sideCats = document.getElementById('sideCats');
                let sideHtml = '';
                
                snapshot.forEach((child) => {
                    const catId = child.key;
                    const catData = child.val();
                    const catName = catData.name || catData;
                    
                    if (catName && catName !== 'All') {
                        const icon = getCategoryIcon(catName);
                        sideHtml += `<a href="shop.html?category=${catId}"><i class="${icon}"></i> ${catName}</a>`;
                    }
                });
                sideCats.innerHTML = sideHtml || '<a href="#">No categories</a>';
            });
        }

        // LOAD CATEGORIES FOR FOOTER
        function loadFooterCategories() {
            database.ref('categories').limitToFirst(6).once('value', (snapshot) => {
                const footerCats = document.getElementById('footerCategories');
                let html = '';
                
                snapshot.forEach((child) => {
                    const catData = child.val();
                    const catName = catData.name || catData;
                    if (catName && catName !== 'All') {
                        html += `<li><a href="shop.html?category=${child.key}"><i class="fas fa-chevron-right"></i> ${catName}</a></li>`;
                    }
                });
                
                footerCats.innerHTML = html || '<li><a href="shop.html"><i class="fas fa-chevron-right"></i> All Categories</a></li>';
            });
        }

        // Newsletter subscription
        function subscribeNewsletter() {
            const email = document.getElementById('newsletterEmail').value.trim();
            if (!email) return;
            
            database.ref('newsletter').push({
                email: email,
                subscribed_at: new Date().toISOString()
            }).then(() => {
                alert('Thank you for subscribing!');
                document.getElementById('newsletterEmail').value = '';
            }).catch(err => {
                console.error('Newsletter subscription failed:', err);
                alert('Subscription failed. Please try again.');
            });
        }

        // Scroll to top button
        window.onscroll = function() {
            const btn = document.getElementById('scrollTopBtn');
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                btn.classList.add('show');
            } else {
                btn.classList.remove('show');
            }
        };

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // ========== PRODUCT DETAILS FUNCTIONS ==========

        // Get product ID from URL
        const productId = new URLSearchParams(window.location.search).get('id');
        let productData = null;
        let selectedVariationId = null;
        let currentSlide = 0;
        let variations = [];
        let allProducts = [];
        let currentProductCategory = null;

        // Load all products for recommendations
        function loadAllProducts() {
            database.ref('products').once('value', (snapshot) => {
                allProducts = [];
                
                snapshot.forEach((child) => {
                    if (child.key !== productId) { // Exclude current product
                        const product = child.val();
                        allProducts.push({
                            id: child.key,
                            ...product
                        });
                    }
                });
            });
        }

        // Load product data
        function loadProduct() {
            if (!productId) { 
                window.location.href = 'shop.html'; 
                return;
            }
            
            database.ref('products/' + productId).on('value', (snapshot) => {
                productData = snapshot.val();
                if (!productData) {
                    alert('Product not found!');
                    window.location.href = 'shop.html';
                    return;
                }

                // Get product category for recommendations
                if (productData.category_ids) {
                    if (typeof productData.category_ids === 'object') {
                        const catIds = Object.keys(productData.category_ids);
                        currentProductCategory = catIds.length > 0 ? catIds[0] : null;
                    } else if (Array.isArray(productData.category_ids)) {
                        currentProductCategory = productData.category_ids[0];
                    }
                } else if (productData.category) {
                    currentProductCategory = productData.category;
                }

                // Convert variations object to array
                if (productData.variations) {
                    variations = Object.entries(productData.variations).map(([id, data]) => {
                        return {
                            id: id,
                            ...data
                        };
                    });
                    
                    // Sort variations by price
                    variations.sort((a, b) => {
                        let priceA = parseFloat(a.sale_price || a.regular_price || 0);
                        let priceB = parseFloat(b.sale_price || b.regular_price || 0);
                        return priceA - priceB;
                    });
                }

                // Hide loading, show product
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('productLayout').style.display = 'flex';
                
                // Set basic info
                document.getElementById('productName').innerText = productData.title || productData.name || 'Product';
                document.getElementById('productDescription').innerHTML = productData.description || 'No description available.';

                // Render sections
                renderGallery();
                renderVariations();
                
                // Show default price if no variations
                if (variations.length === 0) {
                    updatePriceUI(productData.regular_price, productData.sale_price);
                }
                
                updateCartCount();

                // Load recommended products
                loadRecommendedProducts();
            });
        }

        // Load recommended products from same category
        function loadRecommendedProducts() {
            if (!currentProductCategory) {
                document.getElementById('recommendedSection').style.display = 'none';
                return;
            }

            database.ref('products').limitToFirst(10).once('value', (snapshot) => {
                let recommended = [];
                
                snapshot.forEach((child) => {
                    if (child.key === productId) return; // Skip current product
                    
                    const product = child.val();
                    
                    // Check if product belongs to same category
                    let inCategory = false;
                    
                    if (product.category_ids) {
                        if (typeof product.category_ids === 'object') {
                            inCategory = Object.keys(product.category_ids).some(key => 
                                product.category_ids[key] == currentProductCategory || key == currentProductCategory
                            );
                        } else if (Array.isArray(product.category_ids)) {
                            inCategory = product.category_ids.includes(currentProductCategory);
                        }
                    } else if (product.category) {
                        inCategory = product.category == currentProductCategory;
                    }
                    
                    if (inCategory) {
                        recommended.push({
                            id: child.key,
                            ...product
                        });
                    }
                });

                // If not enough from same category, add some random products
                if (recommended.length < 4) {
                    snapshot.forEach((child) => {
                        if (child.key === productId) return;
                        if (recommended.length >= 4) return;
                        
                        const product = child.val();
                        if (!recommended.some(r => r.id === child.key)) {
                            recommended.push({
                                id: child.key,
                                ...product
                            });
                        }
                    });
                }

                // Limit to 4 recommendations
                recommended = recommended.slice(0, 4);

                if (recommended.length > 0) {
                    renderRecommendedProducts(recommended);
                    document.getElementById('recommendedSection').style.display = 'block';
                } else {
                    document.getElementById('recommendedSection').style.display = 'none';
                }
            });
        }

        // Render recommended products
        function renderRecommendedProducts(products) {
            const grid = document.getElementById('recommendedGrid');
            
            grid.innerHTML = products.map(p => {
                let img = p.image;
                if (!img && p.images && p.images.length > 0) {
                    img = p.images[0].src || p.images[0];
                }
                img = img || 'https://via.placeholder.com/300x300?text=MAVRO';

                // Get price
                let price = 0;
                if (p.variations) {
                    const variations = Object.values(p.variations);
                    const prices = variations.map(v => parseFloat(v.sale_price || v.regular_price || 0)).filter(pr => pr > 0);
                    if (prices.length > 0) {
                        price = Math.min(...prices);
                    }
                } else {
                    price = parseFloat(p.sale_price || p.regular_price || 0);
                }

                return `
                    <a href="single-product-details.html?id=${p.id}" class="rec-card">
                        <img src="${img}" class="rec-img" loading="lazy" onerror="this.src='https://via.placeholder.com/300x300?text=MAVRO'">
                        <div class="rec-info">
                            <h4 class="rec-title">${p.name || p.title || 'Product'}</h4>
                            <div class="rec-price">৳${price.toFixed(0)}</div>
                        </div>
                    </a>
                `;
            }).join('');
        }

        // Render product images gallery
        function renderGallery() {
            const wrapper = document.getElementById('sliderWrapper');
            let images = [];
            
            if (productData.images) {
                images = Array.isArray(productData.images) ? productData.images : Object.values(productData.images);
            } else if (productData.image) {
                images = [productData.image];
            }
            
            if (images.length === 0) {
                images = ['https://via.placeholder.com/800x800?text=No+Image'];
            }
            
            wrapper.innerHTML = images.map(img => {
                const imgSrc = img.src || img;
                return `<img src="${imgSrc}" onerror="this.src='https://via.placeholder.com/800x800?text=Image+Error'">`;
            }).join('');
            
            setupSlider();
        }

        // Professional variation name generator
        function getProfessionalVariationName(variation) {
            if (!variation.properties) return 'Standard';
            
            let propertyValues = [];
            
            if (typeof variation.properties === 'object') {
                Object.entries(variation.properties).forEach(([key, value]) => {
                    if (value && typeof value === 'object' && value.name && value.value) {
                        let propValue = value.value;
                        if (propValue.length > 30) {
                            propValue = propValue.substring(0, 30) + '…';
                        }
                        propertyValues.push(propValue);
                    } else if (value && typeof value === 'string') {
                        propertyValues.push(value);
                    }
                });
            }
            
            if (propertyValues.length === 0) {
                return 'Option ' + (variation.id ? variation.id.slice(-4) : '');
            }
            
            if (propertyValues.length === 1) {
                return propertyValues[0];
            } else if (propertyValues.length === 2) {
                return `${propertyValues[0]} / ${propertyValues[1]}`;
            } else {
                return propertyValues.join(' • ');
            }
        }

        // Render variations
        function renderVariations() {
            const container = document.getElementById('variationsContainer');
            container.innerHTML = '';
            
            if (!variations.length) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';

            const group = document.createElement('div');
            group.className = 'variation-section';
            
            const labelDiv = document.createElement('div');
            labelDiv.className = 'variation-label';
            labelDiv.innerHTML = `SELECT OPTION <span class="variation-count">${variations.length} options</span>`;
            group.appendChild(labelDiv);
            
            const scrollContainer = document.createElement('div');
            scrollContainer.className = 'variation-options-container';
            
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'variation-options';
            
            variations.forEach((variation) => {
                const btn = document.createElement('div');
                btn.className = 'variation-option';
                
                const displayName = getProfessionalVariationName(variation);
                
                if (variation.properties) {
                    const firstProp = Object.values(variation.properties)[0];
                    if (firstProp && firstProp.name) {
                        const nameSpan = document.createElement('span');
                        nameSpan.className = 'variation-name';
                        
                        let propName = firstProp.name;
                        if (propName.toLowerCase().includes('color')) propName = 'COLOR';
                        else if (propName.toLowerCase().includes('model')) propName = 'MODEL';
                        else if (propName.toLowerCase().includes('size')) propName = 'SIZE';
                        else propName = propName.toUpperCase();
                        
                        nameSpan.innerText = propName;
                        btn.appendChild(nameSpan);
                    }
                }
                
                const valueSpan = document.createElement('span');
                valueSpan.className = 'variation-value';
                valueSpan.innerText = displayName;
                btn.appendChild(valueSpan);
                
                const price = variation.sale_price || variation.regular_price;
                if (price) {
                    const priceBadge = document.createElement('span');
                    priceBadge.className = 'variation-price-badge';
                    priceBadge.innerText = `৳${price}`;
                    btn.appendChild(priceBadge);
                }
                
                btn.onclick = () => {
                    Array.from(optionsDiv.children).forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    selectedVariationId = variation.id;
                    
                    updatePriceUI(variation.regular_price, variation.sale_price);
                    
                    if (variation.image) {
                        document.getElementById('sliderWrapper').innerHTML = `<img src="${variation.image}" onerror="this.src='https://via.placeholder.com/800x800?text=Image+Error'">`;
                        currentSlide = 0;
                    }
                };
                
                optionsDiv.appendChild(btn);
            });
            
            scrollContainer.appendChild(optionsDiv);
            group.appendChild(scrollContainer);
            container.appendChild(group);
        }

        // Update price display
        function updatePriceUI(reg, sale) {
            const box = document.getElementById('priceBox');
            let r = parseFloat(reg) || 0;
            let s = parseFloat(sale) || 0;

            if (s > 0 && s < r) {
                box.innerHTML = `<span class="sale-price">৳${s.toFixed(0)}</span><span class="regular-price-old">৳${r.toFixed(0)}</span>`;
            } else if (r > 0) {
                box.innerHTML = `<span class="sale-price">৳${r.toFixed(0)}</span>`;
            } else {
                box.innerHTML = `<span class="sale-price">Price on request</span>`;
            }
        }

        // Setup image slider
        function setupSlider() {
            const container = document.getElementById('sliderContainer');
            const wrapper = document.getElementById('sliderWrapper');
            let startX = 0;
            let isDragging = false;

            container.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isDragging = true;
            }, { passive: true });

            container.addEventListener('touchend', (e) => {
                if (!isDragging) return;
                
                let endX = e.changedTouches[0].clientX;
                let images = wrapper.querySelectorAll('img');
                let diff = startX - endX;
                
                if (Math.abs(diff) > 50) {
                    if (diff > 0 && currentSlide < images.length - 1) {
                        currentSlide++;
                    } else if (diff < 0 && currentSlide > 0) {
                        currentSlide--;
                    }
                }
                
                wrapper.style.transform = `translateX(-${currentSlide * 100}%)`;
                isDragging = false;
            }, { passive: true });

            container.addEventListener('mousedown', (e) => {
                startX = e.clientX;
                isDragging = true;
                e.preventDefault();
            });

            container.addEventListener('mouseup', (e) => {
                if (!isDragging) return;
                
                let endX = e.clientX;
                let images = wrapper.querySelectorAll('img');
                let diff = startX - endX;
                
                if (Math.abs(diff) > 50) {
                    if (diff > 0 && currentSlide < images.length - 1) {
                        currentSlide++;
                    } else if (diff < 0 && currentSlide > 0) {
                        currentSlide--;
                    }
                }
                
                wrapper.style.transform = `translateX(-${currentSlide * 100}%)`;
                isDragging = false;
            });

            container.addEventListener('mousemove', (e) => {
                if (isDragging) e.preventDefault();
            });

            container.addEventListener('mouseleave', () => {
                isDragging = false;
            });
        }

        // Add to cart
        document.getElementById('addToCartBtn').onclick = () => {
            if (variations.length > 0 && !selectedVariationId) {
                alert('Please select an option first!');
                return;
            }

            let selectedVariation = null;
            if (selectedVariationId) {
                selectedVariation = variations.find(v => v.id === selectedVariationId);
            }

            let finalPrice = 0;
            if (selectedVariation) {
                finalPrice = parseFloat(selectedVariation.sale_price) || parseFloat(selectedVariation.regular_price) || 0;
            } else {
                finalPrice = parseFloat(productData.sale_price) || parseFloat(productData.regular_price) || 0;
            }

            let productImage = '';
            if (selectedVariation && selectedVariation.image) {
                productImage = selectedVariation.image;
            } else if (productData.images) {
                const images = Array.isArray(productData.images) ? productData.images : Object.values(productData.images);
                productImage = images[0]?.src || images[0] || '';
            } else if (productData.image) {
                productImage = productData.image;
            }

            const cartItem = {
                id: selectedVariationId || (productId + '_' + Date.now()),
                productId: productId,
                variationId: selectedVariationId,
                name: productData.title || productData.name || 'Product',
                price: finalPrice,
                image: productImage,
                quantity: 1
            };

            let cart = JSON.parse(localStorage.getItem('essence_cart') || '[]');
            cart.push(cartItem);
            
            localStorage.setItem('essence_cart', JSON.stringify(cart));
            
            updateCartCount();
            
            const btn = document.getElementById('addToCartBtn');
            const originalText = btn.innerText;
            
            btn.innerText = '✓ ADDED TO CART!';
            btn.style.background = '#4CAF50';
            
            setTimeout(() => { 
                btn.innerText = originalText; 
                btn.style.background = 'var(--primary)'; 
            }, 2000);
        };

        // Update cart count
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('essence_cart') || '[]');
            const countElement = document.getElementById('cartCount');
            countElement.innerText = cart.length;
            
            if (cart.length === 0) {
                countElement.style.display = 'none';
            } else {
                countElement.style.display = 'flex';
            }
        }

        // Initialize
        window.onload = function() {
            loadSideCategories();
            loadFooterCategories();
            loadAllProducts();
            loadProduct();
            updateCartCount();
        };

        // Listen for cart updates
        window.addEventListener('storage', updateCartCount);
    </script>
</body>
</html>
