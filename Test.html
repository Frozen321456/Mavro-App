<!DOCTYPE html>
<html>
<head>
    <title>MoveDrop API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 5px; overflow: auto; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>MoveDrop API Test</h1>
        
        <div class="card">
            <h3>Test Health</h3>
            <button onclick="testHealth()">Test Health</button>
            <pre id="healthResult"></pre>
        </div>

        <div class="card">
            <h3>Test Products</h3>
            <button onclick="testProducts()">Get Products</button>
            <pre id="productsResult"></pre>
        </div>

        <div class="card">
            <h3>Test Orders</h3>
            <button onclick="testOrders()">Get Orders</button>
            <pre id="ordersResult"></pre>
        </div>

        <div class="card">
            <h3>Test Create Order</h3>
            <button onclick="testCreateOrder()">Create Test Order</button>
            <pre id="createOrderResult"></pre>
        </div>
    </div>

    <script>
        const API_URL = 'https://mavro.xo.je/api';
        const API_KEY = 'MAVRO-ESSENCE-SECURE-KEY-2026';

        async function apiCall(endpoint, method = 'GET', data = null) {
            const options = {
                method: method,
                headers: {
                    'X-API-KEY': API_KEY,
                    'Content-Type': 'application/json'
                }
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(`${API_URL}?path=${endpoint}`, options);
                const text = await response.text();
                let json;
                try {
                    json = JSON.parse(text);
                } catch {
                    json = text;
                }
                return { status: response.status, data: json };
            } catch (error) {
                return { error: error.message };
            }
        }

        async function testHealth() {
            const result = await apiCall('health');
            document.getElementById('healthResult').innerHTML = 
                `<span class="${result.status === 200 ? 'success' : 'error'}">Status: ${result.status || 'Error'}</span>\n` +
                JSON.stringify(result.data || result.error, null, 2);
        }

        async function testProducts() {
            const result = await apiCall('products');
            document.getElementById('productsResult').innerHTML = 
                `<span class="${result.status === 200 ? 'success' : 'error'}">Status: ${result.status || 'Error'}</span>\n` +
                JSON.stringify(result.data || result.error, null, 2);
        }

        async function testOrders() {
            const result = await apiCall('orders');
            document.getElementById('ordersResult').innerHTML = 
                `<span class="${result.status === 200 ? 'success' : 'error'}">Status: ${result.status || 'Error'}</span>\n` +
                JSON.stringify(result.data || result.error, null, 2);
        }

        async function testCreateOrder() {
            const testOrder = {
                order_number: 'TEST-' + Date.now(),
                status: 'pending',
                currency: 'BDT',
                total: '1000.00',
                payment_method: 'cod',
                shipping_address: {
                    first_name: 'Test',
                    last_name: 'User',
                    email: 'test@example.com',
                    phone: '01712345678',
                    address_1: 'Test Address',
                    address_2: '',
                    city: 'Dhaka',
                    state: 'Dhaka',
                    postcode: '1200',
                    country: 'Bangladesh'
                },
                customer_notes: 'Test order',
                line_items: [{
                    id: 1,
                    product_id: 1,
                    name: 'Test Product',
                    quantity: 1,
                    total: '1000.00',
                    variations: [{
                        id: 1,
                        variation_id: 1,
                        sku: 'TEST-SKU',
                        quantity: 1,
                        price: '1000.00',
                        created_at: new Date().toISOString()
                    }]
                }]
            };

            const result = await apiCall('orders', 'POST', testOrder);
            document.getElementById('createOrderResult').innerHTML = 
                `<span class="${result.status === 201 ? 'success' : 'error'}">Status: ${result.status || 'Error'}</span>\n` +
                JSON.stringify(result.data || result.error, null, 2);
        }
    </script>
</body>
</html>
