<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ESPERA MAVRO | Premium Global Sourcing</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;600;800&family=Playfair+Display:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #000000;
            --accent: #ff385c;
            --bg: #ffffff;
            --secondary-bg: #f8f8f8;
            --text-muted: #666;
            --border: #e2e2e2;
            --gold: #c5a059;
            --soft-shadow: 0 8px 20px rgba(0,0,0,0.02);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--primary); overflow-x: hidden; }

        /* Smooth scrolling for the whole page */
        html {
            scroll-behavior: smooth;
        }

        /* fade-up animation */
        .fade-up {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }
        .fade-up.appeared {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- Header --- */
        .header { position: fixed; top: 0; width: 100%; height: 60px; background: rgba(255,255,255,0.98); backdrop-filter: blur(10px); z-index: 1000; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 4%; }
        .logo { font-size: 20px; font-weight: 800; letter-spacing: -0.5px; text-decoration: none; color: #000; }
        .logo span { color: var(--accent); }
        
        .nav-actions { display: flex; align-items: center; gap: 15px; }
        .nav-icon { font-size: 18px; color: #000; cursor: pointer; position: relative; }
        .cart-count { position: absolute; top: -8px; right: -10px; background: var(--accent); color: #fff; font-size: 8px; font-weight: 800; padding: 2px 5px; border-radius: 50px; }

        /* --- Search Bar --- */
        .search-wrapper { width: 100%; padding: 75px 4% 10px; background: #fff; }
        .search-inner { position: relative; }
        .search-inner input { width: 100%; padding: 10px 40px 10px 15px; border-radius: 25px; border: 1px solid var(--border); font-size: 13px; background: var(--secondary-bg); }
        .search-inner input:focus { border-color: var(--primary); background: #fff; outline: none; }
        .search-inner button { position: absolute; right: 3px; top: 50%; transform: translateY(-50%); background: var(--primary); color: #fff; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 12px; }

        /* --- Hero --- */
        .hero { position: relative; height: 200px; background: #111; display: flex; align-items: center; overflow: hidden; }
        .hero-content { padding: 0 4%; color: #fff; z-index: 2; width: 100%; }
        .hero-tag { color: var(--gold); font-weight: 600; font-size: 9px; margin-bottom: 5px; display: block; }
        .hero h1 { font-family: 'Playfair Display', serif; font-size: 28px; line-height: 1.1; margin-bottom: 5px; }
        .hero p { font-size: 12px; opacity: 0.7; margin-bottom: 10px; width: 70%; }
        .hero-btn { padding: 8px 20px; background: #fff; color: #000; text-decoration: none; font-weight: 600; border-radius: 25px; font-size: 11px; display: inline-block; }
        .hero-img { position: absolute; right: 0; bottom: 0; width: 55%; height: 100%; object-fit: cover; opacity: 0.4; }

        /* --- Category Grid (single, professional) --- */
        .section-header { padding: 25px 4% 10px; display: flex; justify-content: space-between; align-items: center; }
        .section-header h2 { font-size: 18px; font-weight: 800; }
        .section-header a { font-size: 10px; font-weight: 600; color: #666; text-decoration: none; }
        
        /* Category Grid */
        .cat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 0 4% 20px;
        }
        .cat-grid-item {
            background: var(--secondary-bg);
            border-radius: 16px;
            padding: 18px 4px 14px;
            text-align: center;
            text-decoration: none;
            color: #000;
            transition: all 0.2s;
            border: 1px solid var(--border);
            box-shadow: var(--soft-shadow);
        }
        .cat-grid-item i { font-size: 26px; color: #000; margin-bottom: 8px; display: block; }
        .cat-grid-item span { font-size: 11px; font-weight: 600; }

        /* --- PRODUCT GRID (featured slider) --- */
        .product-grid {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 0 4% 15px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        .product-grid::-webkit-scrollbar { display: none; }

        .p-card { 
            flex: 0 0 72%;
            max-width: 72%;
            background: #fff; 
            padding: 8px; 
            text-decoration: none; 
            color: inherit; 
            position: relative;
            border-radius: 8px;
            scroll-snap-align: start;
            border: 1px solid var(--border);
        }

        .image-container {
            width: 100%;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            background: #f5f5f5;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .image-container img { 
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            display: block;
        }
        
        .p-badge { 
            position: absolute; 
            top: 6px; 
            left: 6px; 
            background: var(--accent); 
            color: #fff; 
            font-size: 7px; 
            font-weight: 700; 
            padding: 2px 5px; 
            border-radius: 2px; 
            z-index: 10; 
        }
        
        .p-card h3 { 
            font-size: 11px; 
            font-weight: 600; 
            margin-bottom: 4px; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            line-height: 1.3;
        }
        
        .p-price { 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            margin-bottom: 2px;
        }
        
        .p-price .sale { 
            font-size: 13px; 
            font-weight: 800; 
            color: var(--accent); 
        }
        
        .wholesale-info { 
            font-size: 7px; 
            color: #2e7d32; 
            font-weight: 600; 
            display: flex; 
            align-items: center; 
            gap: 2px; 
            margin-top: 2px;
        }

        /* --- Banner row --- */
        .banner-row {
            display: flex;
            gap: 8px;
            padding: 0 4% 20px;
        }
        .banner-half {
            flex: 1;
            background: #f1f0f0;
            border-radius: 20px;
            padding: 18px 12px;
            min-height: 100px;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--soft-shadow);
        }
        .banner-half::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.1) 80%);
            z-index: 1;
        }
        .banner-content {
            position: relative;
            z-index: 2;
            color: white;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .banner-content .tag {
            font-size: 8px;
            font-weight: 600;
            letter-spacing: 1px;
            background: rgba(255,255,255,0.2);
            display: inline-block;
            padding: 2px 8px;
            border-radius: 50px;
            width: fit-content;
            margin-bottom: 4px;
        }
        .banner-content h4 { font-size: 14px; font-weight: 800; margin-bottom: 2px; }
        .banner-content p { font-size: 9px; opacity: 0.9; }

        /* --- Service strip --- */
        .service-strip {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 0 4% 25px;
        }
        .service-card {
            background: var(--secondary-bg);
            border-radius: 20px;
            padding: 18px 4px;
            text-align: center;
            border: 1px solid var(--border);
            box-shadow: var(--soft-shadow);
        }
        .service-card i { font-size: 22px; color: #000; margin-bottom: 6px; }
        .service-card h5 { font-size: 11px; font-weight: 800; margin-bottom: 4px; }
        .service-card p { font-size: 7px; color: #555; }

        /* --- Review Form (new) --- */
        .review-form-section {
            padding: 20px 4% 30px;
            background: #fafafa;
            margin: 10px 4% 20px;
            border-radius: 28px;
            border: 1px solid var(--border);
        }
        .review-form-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
        }
        .review-form-group {
            margin-bottom: 14px;
        }
        .review-form-group label {
            font-size: 11px;
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
            color: #333;
        }
        .review-form-group input, 
        .review-form-group textarea,
        .review-form-group select {
            width: 100%;
            padding: 12px 14px;
            border-radius: 30px;
            border: 1px solid var(--border);
            font-size: 13px;
            background: white;
        }
        .review-form-group textarea {
            border-radius: 20px;
            resize: vertical;
            min-height: 80px;
        }
        .rating-stars {
            display: flex;
            gap: 10px;
            font-size: 28px;
            color: #ccc;
            cursor: pointer;
            margin: 5px 0;
        }
        .rating-stars i {
            transition: color 0.2s;
        }
        .rating-stars i.selected {
            color: #f5b342;
        }
        .rating-stars i:hover {
            color: #f5b342;
        }
        .submit-review-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 13px;
            width: 100%;
            margin-top: 10px;
            cursor: pointer;
        }
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 30px;
            font-size: 12px;
            text-align: center;
            margin-bottom: 10px;
            display: none;
        }

        /* --- Reviews Display (from Firebase) --- */
        .review-scroll {
            display: flex;
            gap: 14px;
            overflow-x: auto;
            padding: 0 4% 25px;
            scrollbar-width: none;
        }
        .review-scroll::-webkit-scrollbar { display: none; }
        .review-card {
            flex: 0 0 70%;
            background: #fff;
            border-radius: 24px;
            padding: 22px 18px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 25px rgba(0,0,0,0.02);
        }
        .review-stars { color: #f5b342; font-size: 14px; margin-bottom: 8px; }
        .review-text { font-size: 12px; font-weight: 400; margin-bottom: 16px; line-height: 1.5; }
        .reviewer { display: flex; align-items: center; gap: 10px; }
        .reviewer img { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 1px solid #eee; }
        .reviewer strong { font-size: 12px; }
        .review-date { font-size: 8px; color: #aaa; margin-left: auto; }

        /* --- Trust badges --- */
        .trust-badge-row {
            display: flex;
            justify-content: space-around;
            padding: 10px 4% 25px;
            background: #fafafa;
            margin: 0 4% 20px;
            border-radius: 40px;
        }
        .trust-item {
            text-align: center;
        }
        .trust-item i { font-size: 22px; color: #2e7d32; }
        .trust-item span { display: block; font-size: 9px; font-weight: 600; margin-top: 4px; }

        /* --- Newsletter --- */
        .newsletter {
            background: #111;
            margin: 10px 4% 30px;
            border-radius: 30px;
            padding: 28px 16px;
            color: white;
            text-align: center;
        }
        .newsletter h3 { font-size: 16px; font-weight: 700; margin-bottom: 6px; }
        .newsletter p { font-size: 10px; opacity: 0.7; margin-bottom: 16px; }
        .newsletter-input {
            display: flex;
            background: #2a2a2a;
            border-radius: 40px;
            padding: 4px;
            max-width: 280px;
            margin: 0 auto;
        }
        .newsletter-input input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 8px 14px;
            color: white;
            font-size: 11px;
        }
        .newsletter-input input::placeholder { color: #777; }
        .newsletter-input button {
            background: var(--accent);
            border: none;
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 8px 14px;
            border-radius: 30px;
            cursor: pointer;
        }

        /* --- Sidebar --- */
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); opacity: 0; pointer-events: none; transition: 0.3s; z-index: 1999; }
        .sidebar-overlay.active { opacity: 1; pointer-events: all; }
        .sidebar { position: fixed; top: 0; left: -100%; width: 260px; height: 100%; background: #fff; z-index: 2000; transition: 0.3s; padding: 35px 20px; overflow-y: auto; }
        .sidebar.active { left: 0; }
        .sidebar-close { position: absolute; right: 12px; top: 12px; font-size: 18px; cursor: pointer; }
        .side-links { margin-top: 35px; }
        .side-links a { display: block; font-size: 16px; font-weight: 700; color: #000; text-decoration: none; margin-bottom: 15px; }
        .side-cats-title { margin-top: 25px; font-size: 10px; font-weight: 700; color: #888; letter-spacing: 1px; margin-bottom: 12px; }
        .side-cat-list a { display: block; font-size: 13px; font-weight: 500; margin-bottom: 10px; color: #444; text-decoration: none; }
        .side-cat-list a i { width: 18px; margin-right: 6px; color: var(--accent); font-size: 12px; }

        /* --- Footer --- */
        .footer { background: #000; color: #fff; padding: 40px 4% 15px; margin-top: 30px; }
        .footer-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .footer-logo { font-size: 20px; font-weight: 800; margin-bottom: 8px; }
        .footer h4 { margin-bottom: 10px; font-size: 11px; text-transform: uppercase; }
        .footer p, .footer a { color: #888; text-decoration: none; font-size: 11px; margin-bottom: 5px; display: block; }
        .footer .social-icons { display: flex; gap: 14px; margin: 15px 0; }
        .footer .social-icons i { font-size: 18px; color: #aaa; }

        .loading { text-align: center; padding: 20px; color: #999; font-size: 12px; }

        @media (min-width: 768px) {
            .product-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                overflow-x: visible;
                gap: 15px;
            }
            .p-card { flex: none; max-width: 100%; }
            .review-card { flex: 0 0 40%; }
            .cat-grid { grid-template-columns: repeat(6,1fr); }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="nav-icon" onclick="toggleMenu()"><i class="fa-solid fa-bars-staggered"></i></div>
        <a href="index.html" class="logo">ESPERA <span>MAVRO.</span></a>
        <div class="nav-actions">
            <i class="fa-solid fa-magnifying-glass nav-icon" onclick="document.getElementById('searchInput').focus()"></i>
            <a href="cart.html" class="nav-icon">
                <i class="fa-solid fa-bag-shopping"></i>
                <span class="cart-count" id="cartCount">0</span>
            </a>
        </div>
    </header>

    <div class="sidebar-overlay" id="overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-close" onclick="toggleMenu()"><i class="fa-solid fa-xmark"></i></div>
        <div class="side-links">
            <a href="index.html">Home</a>
            <a href="shop.html">Shop</a>
            <a href="track-order.html">Track Order</a>
            <a href="cart.html">Cart</a>
        </div>
        <div class="side-cats-title">CATEGORIES</div>
        <div class="side-cat-list" id="sideCats"></div>
    </div>

    <div class="search-wrapper">
        <div class="search-inner">
            <input type="text" id="searchInput" placeholder="Search products..." onkeyup="handleSearch(event)">
            <button onclick="doSearch()"><i class="fa-solid fa-arrow-right"></i></button>
        </div>
    </div>

    <!-- hero section (with fade) -->
    <section class="hero fade-up">
        <div class="hero-content">
            <span class="hero-tag">CHINA TO BANGLADESH</span>
            <h1>Global<br>Wholesale</h1>
            <p>Premium sourcing with door-to-door shipping</p>
            <a href="shop.html" class="hero-btn">SHOP NOW</a>
        </div>
        <img src="https://images.unsplash.com/photo-1578575437130-527eed3abbec?auto=format&fit=crop&w=1000&q=80" class="hero-img" alt="hero" loading="lazy">
    </section>

    <!-- Single Category Grid -->
    <section class="section-header fade-up">
        <h2>Shop by Category</h2>
        <a href="shop.html">all</a>
    </section>
    <div class="cat-grid fade-up" id="featuredCatGrid"></div>

    <!-- Featured products slider -->
    <section class="section-header fade-up">
        <h2>Featured Products</h2>
        <span style="font-size: 9px; background: #f0f0f0; padding: 2px 6px; border-radius: 20px;">HOT</span>
    </section>
    <div class="product-grid fade-up" id="productGrid">
        <div class="loading">Loading products...</div>
    </div>

    <!-- banner row -->
    <div class="banner-row fade-up">
        <div class="banner-half" style="background-image: url('https://images.unsplash.com/photo-1555529771-122e5d9f2341?auto=format&fit=crop&w=600&q=80');">
            <div class="banner-content">
                <span class="tag">SUMMER 26</span>
                <h4>Essentials</h4>
                <p>up to 40% off</p>
            </div>
        </div>
        <div class="banner-half" style="background-image: url('https://images.unsplash.com/photo-1584917865442-2d7b27f2a3e9?auto=format&fit=crop&w=600&q=80');">
            <div class="banner-content">
                <span class="tag">BAGS</span>
                <h4>Leather</h4>
                <p>wholesale price</p>
            </div>
        </div>
    </div>

    <!-- service strip -->
    <div class="service-strip fade-up">
        <div class="service-card">
            <i class="fa-solid fa-truck-fast"></i>
            <h5>Door-to-Door</h5>
            <p>China-BD express</p>
        </div>
        <div class="service-card">
            <i class="fa-solid fa-hand-holding-dollar"></i>
            <h5>Wholesale</h5>
            <p>low MOQ</p>
        </div>
        <div class="service-card">
            <i class="fa-solid fa-shield"></i>
            <h5>Secure Payment</h5>
            <p>escrow available</p>
        </div>
        <div class="service-card">
            <i class="fa-solid fa-clock"></i>
            <h5>24/7 Support</h5>
            <p>chat with us</p>
        </div>
    </div>

    <!-- Trust badges -->
    <div class="trust-badge-row fade-up">
        <div class="trust-item"><i class="fa-regular fa-circle-check"></i><span>Verified</span></div>
        <div class="trust-item"><i class="fa-regular fa-gem"></i><span>Premium</span></div>
        <div class="trust-item"><i class="fa-regular fa-credit-card"></i><span>Secure</span></div>
        <div class="trust-item"><i class="fa-regular fa-clock"></i><span>Fast</span></div>
    </div>

    <!-- ========== NEW REVIEW FORM ========== -->
    <div class="review-form-section fade-up">
        <div class="review-form-title">✨ Share your experience</div>
        <div class="success-message" id="reviewSuccess">Thank you! Your review has been posted.</div>
        
        <div class="review-form-group">
            <label>Your name *</label>
            <input type="text" id="reviewerName" placeholder="e.g. Tanvir Ahmed" required>
        </div>

        <div class="review-form-group">
            <label>Rating *</label>
            <div class="rating-stars" id="starRatingWidget">
                <i class="fa-regular fa-star" data-value="1"></i>
                <i class="fa-regular fa-star" data-value="2"></i>
                <i class="fa-regular fa-star" data-value="3"></i>
                <i class="fa-regular fa-star" data-value="4"></i>
                <i class="fa-regular fa-star" data-value="5"></i>
            </div>
            <input type="hidden" id="ratingValue" value="0">
        </div>

        <div class="review-form-group">
            <label>Your review *</label>
            <textarea id="reviewText" placeholder="What did you like or dislike?"></textarea>
        </div>

        <button class="submit-review-btn" onclick="submitReview()">POST REVIEW</button>
    </div>

    <!-- Customer Reviews Display from Firebase -->
    <section class="section-header fade-up">
        <h2>Customer reviews</h2>
        <span><i class="fa-solid fa-star" style="color: var(--gold);"></i> <span id="averageRating">4.8</span></span>
    </section>
    <div class="review-scroll fade-up" id="reviewContainer">
        <div class="loading">Loading reviews...</div>
    </div>

    <!-- Newsletter -->
    <div class="newsletter fade-up">
        <h3>Wholesale alerts</h3>
        <p>Get new collection & bulk deals first</p>
        <div class="newsletter-input">
            <input type="email" placeholder="Your email">
            <button>Subscribe</button>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-grid">
            <div>
                <div class="footer-logo">ESPERA MAVRO.</div>
                <p>Direct-to-factory global sourcing</p>
                <div class="social-icons">
                    <i class="fa-brands fa-facebook"></i>
                    <i class="fa-brands fa-instagram"></i>
                    <i class="fa-brands fa-whatsapp"></i>
                </div>
            </div>
            <div>
                <h4>Quick Links</h4>
                <a href="shop.html">Shop</a>
                <a href="#">Wholesale</a>
                <a href="track-order.html">Tracking</a>
                <a href="#">About</a>
            </div>
        </div>
        <div style="border-top: 1px solid #222; padding-top: 12px; text-align: center; color: #444; font-size: 9px;">
            © 2026 ESPERA MAVRO — global sourcing
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // FIREBASE INIT
        const firebaseConfig = {
            apiKey: "AIzaSyAB7dyaJwkadV7asGOhj6TCN5it5pCWg10",
            authDomain: "espera-mavro-6ddc5.firebaseapp.com",
            databaseURL: "https://espera-mavro-6ddc5-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "espera-mavro-6ddc5",
            storageBucket: "espera-mavro-6ddc5.appspot.com",
            appId: "1:137893255543:web:a660bd412eb26ee322a972"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // icons helper
        const categoryIcons = {
            'fashion': 'fa-solid fa-shirt',
            'womens fashion': 'fa-solid fa-person-dress',
            'bag': 'fa-solid fa-bag-shopping',
            'household': 'fa-solid fa-couch',
            'cosmetics': 'fa-solid fa-spray-can-sparkles',
            'beauty': 'fa-solid fa-star',
            'default': 'fa-solid fa-cube'
        };
        function getCategoryIcon(catName) {
            if (!catName) return categoryIcons.default;
            const key = catName.toLowerCase();
            if (key.includes('fashion')) return 'fa-solid fa-shirt';
            if (key.includes('womens')) return 'fa-solid fa-person-dress';
            if (key.includes('bag')) return 'fa-solid fa-bag-shopping';
            if (key.includes('house')) return 'fa-solid fa-couch';
            if (key.includes('cosmetic')) return 'fa-solid fa-spray-can-sparkles';
            return categoryIcons.default;
        }

        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        // LOAD CATEGORIES
        function loadCategories() {
            database.ref('categories').once('value', (snapshot) => {
                const sideCats = document.getElementById('sideCats');
                const featGrid = document.getElementById('featuredCatGrid');
                let sideHtml = '';
                let gridHtml = '';
                let count = 0;
                
                snapshot.forEach((child) => {
                    const catId = child.key;
                    const catData = child.val();
                    const catName = catData.name || catData;
                    
                    if (catName && catName !== 'All') {
                        const icon = getCategoryIcon(catName);
                        sideHtml += `<a href="shop.html?category=${catId}"><i class="${icon}"></i> ${catName}</a>`;
                        if (count < 6) {
                            gridHtml += `
                                <a href="shop.html?category=${catId}" class="cat-grid-item">
                                    <i class="${icon}"></i>
                                    <span>${catName}</span>
                                </a>
                            `;
                        }
                        count++;
                    }
                });
                sideCats.innerHTML = sideHtml || '<a href="#">No categories</a>';
                featGrid.innerHTML = gridHtml || '<div style="grid-column:span3">No categories</div>';
            });
        }

        // LOAD FEATURED PRODUCTS
        function loadProducts() {
            database.ref('products').limitToFirst(8).once('value', (snapshot) => {
                const grid = document.getElementById('productGrid');
                if (!snapshot.exists()) {
                    grid.innerHTML = '<div class="loading">No products</div>';
                    return;
                }
                let productsHtml = '';
                snapshot.forEach((child) => {
                    const product = child.val();
                    const productId = child.key;
                    let imgUrl = product.image;
                    if (!imgUrl && product.images) {
                        if (Array.isArray(product.images)) imgUrl = product.images[0]?.src || product.images[0];
                        else if (typeof product.images === 'object') {
                            const firstImg = Object.values(product.images)[0];
                            imgUrl = firstImg?.src || firstImg;
                        }
                    }
                    imgUrl = imgUrl || 'https://via.placeholder.com/300x300?text=MAVRO';
                    let price = product.sale_price || product.price || product.regular_price || 0;
                    if (price === "undefined" || price === "") price = 0;
                    price = parseFloat(price) || 0;
                    let priceDisplay = `৳${price}`;
                    
                    productsHtml += `
                        <a href="single-product-details.html?id=${productId}" class="p-card">
                            <span class="p-badge">${product.badge || 'NEW'}</span>
                            <div class="image-container">
                                <img src="${imgUrl}" alt="${product.name || product.title || 'Product'}" loading="lazy" onerror="this.src='https://via.placeholder.com/300x300?text=MAVRO'">
                            </div>
                            <h3>${product.name || product.title || 'Mavro Product'}</h3>
                            <div class="p-price"><span class="sale">${priceDisplay}</span></div>
                            <div class="wholesale-info"><i class="fa-solid fa-check-circle"></i> Wholesale</div>
                        </a>
                    `;
                });
                grid.innerHTML = productsHtml;
            });
        }

        // ========== REVIEW STAR WIDGET ==========
        const stars = document.querySelectorAll('#starRatingWidget i');
        const ratingInput = document.getElementById('ratingValue');
        stars.forEach(star => {
            star.addEventListener('click', function() {
                const val = this.dataset.value;
                ratingInput.value = val;
                stars.forEach(s => {
                    if (s.dataset.value <= val) {
                        s.classList.remove('fa-regular');
                        s.classList.add('fa-solid', 'selected');
                    } else {
                        s.classList.add('fa-regular');
                        s.classList.remove('fa-solid', 'selected');
                    }
                });
            });
        });

        // SUBMIT REVIEW TO FIREBASE
        function submitReview() {
            const name = document.getElementById('reviewerName').value.trim();
            const rating = parseInt(document.getElementById('ratingValue').value);
            const text = document.getElementById('reviewText').value.trim();
            
            if (!name) { alert('Please enter your name'); return; }
            if (rating === 0) { alert('Please select a rating'); return; }
            if (!text) { alert('Please write your review'); return; }

            const newReviewRef = database.ref('reviews').push();
            newReviewRef.set({
                name: name,
                rating: rating,
                text: text,
                date: new Date().toISOString(),
                avatar: `https://i.pravatar.cc/40?u=${name.replace(/\s/g,'')}`
            }).then(() => {
                // show success, reset form
                document.getElementById('reviewSuccess').style.display = 'block';
                document.getElementById('reviewerName').value = '';
                document.getElementById('ratingValue').value = '0';
                document.getElementById('reviewText').value = '';
                stars.forEach(s => {
                    s.classList.add('fa-regular');
                    s.classList.remove('fa-solid', 'selected');
                });
                setTimeout(() => {
                    document.getElementById('reviewSuccess').style.display = 'none';
                }, 3000);
                // refresh reviews
                loadReviews();
            }).catch(err => console.error(err));
        }

        // LOAD REVIEWS FROM FIREBASE
        function loadReviews() {
            const reviewContainer = document.getElementById('reviewContainer');
            database.ref('reviews').once('value', (snapshot) => {
                if (!snapshot.exists()) {
                    reviewContainer.innerHTML = '<div class="loading">No reviews yet — be the first!</div>';
                    return;
                }
                let reviewsHtml = '';
                let totalStars = 0;
                let reviewCount = 0;
                snapshot.forEach((child) => {
                    const r = child.val();
                    const stars = r.rating || 5;
                    totalStars += stars;
                    reviewCount++;
                    const date = r.date ? new Date(r.date).toLocaleDateString() : 'just now';
                    const img = r.avatar || 'https://i.pravatar.cc/40?u='+r.name;
                    reviewsHtml += `
                        <div class="review-card">
                            <div class="review-stars">${'★'.repeat(stars)}${'☆'.repeat(5-stars)}</div>
                            <div class="review-text">"${r.text || 'Amazing quality and fast shipping'}"</div>
                            <div class="reviewer">
                                <img src="${img}" alt="user">
                                <strong>${r.name || 'Buyer'}</strong>
                                <span class="review-date">${date}</span>
                            </div>
                        </div>
                    `;
                });
                const avg = reviewCount ? (totalStars/reviewCount).toFixed(1) : '4.8';
                document.getElementById('averageRating').innerText = avg;
                reviewContainer.innerHTML = reviewsHtml;
            });
        }

        // search handlers
        function handleSearch(e) { if(e.key === 'Enter') doSearch(); }
        function doSearch() {
            const q = document.getElementById('searchInput').value.trim();
            if(q) window.location.href = `shop.html?search=${encodeURIComponent(q)}`;
        }

        // cart count
        function updateCartCount() {
            try {
                const cart = JSON.parse(localStorage.getItem('essence_cart') || "[]");
                document.getElementById('cartCount').innerText = cart.length;
            } catch (e) {}
        }

        // intersection observer for fade-up
        function observeFade() {
            const faders = document.querySelectorAll('.fade-up');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('appeared');
                    }
                });
            }, { threshold: 0.1 });
            faders.forEach(el => observer.observe(el));
        }

        window.onload = () => {
            loadCategories();
            loadProducts();
            loadReviews();
            updateCartCount();
            observeFade();
        };
        window.addEventListener('storage', updateCartCount);
    </script>
</body>
</html>